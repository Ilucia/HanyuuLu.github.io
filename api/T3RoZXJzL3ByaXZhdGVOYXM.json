{"title":"低成本个人NAS搭建解决方案（带内网穿透）","date":"2019-12-10T00:00:00.000Z","link":"Others/privateNas","tags":["nas","network","raspberrypi"],"categories":["solution"],"updated":"2022-04-27T15:24:01.579Z","content":"<h1 id=\"hardware\"><a class=\"markdownIt-Anchor\" href=\"Others/privateNas#hardware\"></a> Hardware<a href=\"Others/privateNas#hardware\"></a></h1>\n<ul>\n<li>PC 或者 Raspberrypi 3b+ 一台</li>\n<li>周边设备（键盘、鼠标、树莓派的储存卡之类）</li>\n<li>可用的网络链接（内网有内网穿透方案）</li>\n</ul>\n<h1 id=\"software\"><a class=\"markdownIt-Anchor\" href=\"Others/privateNas#software\"></a> Software<a href=\"Others/privateNas#software\"></a></h1>\n<ul>\n<li>操作系统下载\n<ul>\n<li>x86/x86_64\n<ul>\n<li><a href=\"https://www.microsoft.com/zh-cn/software-download/windows10\" target=\"_blank\" rel=\"noopener\">windows</a></li>\n<li><a href=\"https://www.deepin.org/\" target=\"_blank\" rel=\"noopener\">deepin</a></li>\n<li><a href=\"https://ubuntu.com/\" target=\"_blank\" rel=\"noopener\">ubuntu</a></li>\n</ul>\n</li>\n<li>armv7 (Raspberry 3b(+)/4b)\n<ul>\n<li><a href=\"https://www.raspberrypi.org/downloads/raspbian/\" target=\"_blank\" rel=\"noopener\">raspbian</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>搭建NAS可以使用server版本，机子有其他用途也可以使用其他版本</p>\n</blockquote>\n<h1 id=\"step\"><a class=\"markdownIt-Anchor\" href=\"Others/privateNas#step\"></a> Step<a href=\"Others/privateNas#step\"></a></h1>\n<blockquote>\n<p>以Raspberry 3b+、Raspbian Buster with desktop、Nignx、Seafile Community组合为例。</p>\n</blockquote>\n<ol>\n<li>安装操作系统，安装流程参见各下载链接的官方安装文档</li>\n<li>测试网络连接</li>\n<li>国内用户使用Luiux系统请替换源以加速后续安装。\n<ul>\n<li><a href=\"https://mirrors.tuna.tsinghua.edu.cn/\" target=\"_blank\" rel=\"noopener\">tuna</a></li>\n</ul>\n<blockquote>\n<p>找到对应的发行版然后戳右边问号小圆圈即可跳转到换源页面,比如raspbian的换源页面为<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/\" target=\"_blank\" rel=\"noopener\">https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/</a></p>\n</blockquote>\n</li>\n<li>安装<a href=\"https://www.seafile.com/home/\" target=\"_blank\" rel=\"noopener\">seafile</a>服务\n<ol>\n<li>跳转到<a href=\"https://www.seafile.com/download/\" target=\"_blank\" rel=\"noopener\">下载</a>页面选择对应的服务器端程序，<a href=\"https://github.com/haiwen/seafile-rpi/releases\" target=\"_blank\" rel=\"noopener\">raspberry服务器端链接</a>，下载最新的release的.tar.gz文件（无gui环境可以使用wget下载）</li>\n<li>参照seafile的<a href=\"https://cloud.seafile.com/published/seafile-manual-cn/deploy/using_sqlite.md\" target=\"_blank\" rel=\"noopener\">官方教程:部署Seafile 服务器（使用SQLite）</a>进行安装，我们假定你并未更改默认的端口号（file端口8082,hub端口8000,若更改了请自行在后续说明中自行对应即可)</li>\n<li>启动seafile测试能在localhost上访问到seafile服务<br>\n`http://localhost:8000’</li>\n</ol>\n</li>\n<li>安装Nginx服务<br>\n<code>sudo apt install nginx</code>安装完后启动Nginx(apt装完后直接启动) <code>http://localhost</code>能访问到Nginx的默认页面</li>\n<li>将Nginx服务请求转接到seafile上<br>\n编辑<code>/etc/nginx/site-enabled/default</code>或者Nginx目录下的nginx.conf文件(windows)，建立服务器配置，将根节点转接到hub端口(8000)，将/server节点转接到file端口(8082)，参考如下</li>\n</ol>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  server &#123;</span><br><span class=\"line\">        listen 80 default_server;\t# 监听在80端口，ipv4</span><br><span class=\"line\">        listen [::]:80 default_server;\t# 监听在80端口, ipv6</span><br><span class=\"line\">        location / &#123;\t# 节点</span><br><span class=\"line\">                proxy_pass http://127.0.0.1:8000/;\t# 转发端口</span><br><span class=\"line\">                client_max_body_size 8000m;\t# 请求体大小限制（决定上传下载文件大小上限）</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location /server/ &#123;</span><br><span class=\"line\">                proxy_pass http://127.0.0.1:8082/;</span><br><span class=\"line\">                client_max_body_size 8000m;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<ol start=\"7\">\n<li>在seafile上进行设置\n<ol>\n<li>管理员账户登陆，选择系统设置，设置，URL</li>\n<li>设置SERVICE_URL和FILE_SERVER_ROOT为<code>http://[计算机名]</code>和<code>http://[计算机名]/server</code>（树莓派计算机名默认为raspberrypi）</li>\n</ol>\n</li>\n<li>做内网穿透（可选）\n<ol>\n<li>使用<a href=\"https://www.zerotier.com/\" target=\"_blank\" rel=\"noopener\">zerotier</a>，新建一个账号并创建一个网络</li>\n<li>在服务器上安装zerotier，<a href=\"https://www.zerotier.com/download/\" target=\"_blank\" rel=\"noopener\">下载并安装客户端</a></li>\n<li>加入网络（gui直接戳戳按钮，zerotier-cli请参阅<a href=\"https://zerotier.atlassian.net/wiki/spaces/SD/pages/29065282/zerotier-cli\" target=\"_blank\" rel=\"noopener\">zerotier-cli</a>）</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"finish\"><a class=\"markdownIt-Anchor\" href=\"Others/privateNas#finish\"></a> Finish<a href=\"Others/privateNas#finish\"></a></h1>\n<p>[]<sub>(￣▽￣)</sub>*<br>\n使用设备只需要安装zerotier并加入对应网络即可通过访问<code>http://[服务器计算机名]</code>即可</p>\n","prev":{"title":"DevOps CICD 零基础简介和实践","link":"cicd"},"next":{"title":"软件测试小结","link":"Review/SoftwareTest"},"plink":"ilucia.github.io/Others/privateNas/","toc":[{"title":"<a class=\"markdownIt-Anchor\"></a> Hardware","id":"hardware","index":"1"},{"title":"<a class=\"markdownIt-Anchor\"></a> Software","id":"software","index":"2"},{"title":"<a class=\"markdownIt-Anchor\"></a> Step","id":"step","index":"3"},{"title":"<a class=\"markdownIt-Anchor\"></a> Finish","id":"finish","index":"4"}],"copyright":{"author":"Ilucia Niu","license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\">知识共享署名 4.0 国际许可协议</a>","published":"2019年12月10日","updated":"2022年4月27日"}}