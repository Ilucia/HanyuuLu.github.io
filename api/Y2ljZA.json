{"title":"DevOps CICD 零基础简介和实践","date":"2020-03-01T00:00:00.000Z","link":"cicd","tags":["CICD","Github"],"updated":"2022-04-27T15:24:01.715Z","content":"<iframe width=\"1080px\" height=\"600px\" src=\"//player.bilibili.com/player.html?aid=92987568&cid=158758069&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n<h1 id=\"关于devops和cicd\"><a class=\"markdownIt-Anchor\" href=\"cicd#关于devops和cicd\"></a> 关于DevOps和CICD<a href=\"cicd#关于devops和cicd\"></a></h1>\n<h2 id=\"一些前置名词介绍\"><a class=\"markdownIt-Anchor\" href=\"cicd#一些前置名词介绍\"></a> 一些前置名词介绍<a href=\"cicd#一些前置名词介绍\"></a></h2>\n<ul>\n<li>\n<p><strong>敏捷开发：</strong>(Agile software development)是一种应对快速变化的需求的一种软件开发能力。相对于『非敏捷』，更强调程序猿团队和产品设计团队的紧密协作、面对面的沟通、频繁交付新的软件版本、紧凑而自我组织型的团队、能够更好的适应需求变化的代码编写和团队组织方法。</p>\n</li>\n<li>\n<p><strong>持续集成：</strong>(Continuous Integration) 是一种软件开发实践，即团队开发人员经常集成他们的工作，通常每个成员每天至少集成一次，也就意味着每天可能会发生多次集成。每次的集成都通过自动化的构建（包括编译、发布、自动化测试）来验证</p>\n</li>\n<li>\n<p><strong>持续部署：</strong>(Continuous Deployment) 通过自动化的构建、测试和部署循环来快速交付高质量的产品。某种程度上代表了一个开发团队工程化的程度。</p>\n</li>\n<li>\n<p><strong>持续交付：</strong>(Continuous Delivery:CD) 让软件的产出过程在一个短周期内完成，以保证软件可以稳定、持续的保持在随时可以释出的状态。它的目标在于让软件的建制、测试与释放变的更快以及更频繁。这种方式可以减少软件开发的成本与时间，减少风险。</p>\n</li>\n</ul>\n<h1 id=\"为什么需要devops\"><a class=\"markdownIt-Anchor\" href=\"cicd#为什么需要devops\"></a> 为什么需要DevOps?<a href=\"cicd#为什么需要devops\"></a></h1>\n<ul>\n<li>\n<p>传统软件开发流程：</p>\n<ul>\n<li>规划→编码→构建→测试→发布→部署→维护</li>\n<li>开发\n<ul>\n<li>规划、编码和构建</li>\n</ul>\n</li>\n<li>测试\n<ul>\n<li>测试</li>\n</ul>\n</li>\n<li>运维\n<ul>\n<li>发布、部署和维护</li>\n</ul>\n</li>\n<li>早期的软件交付模型：瀑布模型（Waterfall）模型</li>\n<li><img src=\"/cicd/image-20200301004205120.png\" alt=\"image-20200301004205120\"></li>\n<li>缺点\n<ul>\n<li>反应迟缓、流程越往后走更改需求带来的额外成本急速上升</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>DevOps</p>\n<p><img src=\"/cicd/image-20200301004643842.png\" alt=\"image-20200301004643842\" class=\"article-img\"></p>\n<ul>\n<li>\n<p>Development &amp; Operations</p>\n</li>\n<li>\n<p>DevOps是一组过程、方法与系统的统称，用于促进<strong>开发</strong>、<strong>技术运营</strong>和**质量保障（QA）**部门之间的沟通、协作与整合。</p>\n</li>\n<li>\n<p><img src=\"/cicd/image-20200301004839838.png\" alt=\"image-20200301004839838\" class=\"article-img\"></p>\n</li>\n<li>\n<p>从目标来看，DevOps就是让开发人员和运维人员更好地沟通合作，通过自动化流程来使得软件整体过程更加快捷和可靠。</p>\n</li>\n<li>\n<p>在DevOps的流程下，运维人员会在项目开发期间就介入到开发过程中，了解开发人员使用的系统架构和技术路线，从而制定适当的运维方案。而开发人员也会在运维的初期参与到系统部署中，并提供系统部署的优化建议。</p>\n</li>\n<li>\n<p>DevOps的实施，促进开发和运维人员的沟通，增进彼此的理解。</p>\n</li>\n<li>\n<p><img src=\"/cicd/image-20200301005236933.png\" alt=\"image-20200301005236933\" class=\"article-img\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"cicd实践以github-action平台为例\"><a class=\"markdownIt-Anchor\" href=\"cicd#cicd实践以github-action平台为例\"></a> CICD实践：以GitHub action平台为例<a href=\"cicd#cicd实践以github-action平台为例\"></a></h1>\n<h2 id=\"ui\"><a class=\"markdownIt-Anchor\" href=\"cicd#ui\"></a> UI<a href=\"cicd#ui\"></a></h2>\n<p><img src=\"/cicd/annotated-workflow.png\" alt=\"Annotated workflow run image\" class=\"article-img\"></p>\n<h2 id=\"creating-a-workflow-file\"><a class=\"markdownIt-Anchor\" href=\"cicd#creating-a-workflow-file\"></a> Creating a workflow file<a href=\"cicd#creating-a-workflow-file\"></a></h2>\n<p>At a high level, these are the steps to add a workflow file. You can  find specific configuration examples in the sections that follow.</p>\n<ol>\n<li>At the root of your repository, create a directory named <code>.github/workflows</code> to store your workflow files.</li>\n<li>In <code>.github/workflows</code>, add a <code>.yml</code> or <code>.yaml</code> file for your workflow. For example, <code>.github/workflows/continuous-integration-workflow.yml</code>.</li>\n<li>Use the “<a href=\"https://help.github.com/en/articles/workflow-syntax-for-github-actions\" target=\"_blank\" rel=\"noopener\">Workflow syntax for GitHub Actions</a>” reference documentation to choose events to trigger an action, add actions, and customize your workflow.</li>\n<li>Commit your changes in the workflow file to the branch where you want your workflow to run.</li>\n</ol>\n<h2 id=\"sample\"><a class=\"markdownIt-Anchor\" href=\"cicd#sample\"></a> Sample<a href=\"cicd#sample\"></a></h2>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Greet</span> <span class=\"string\">Everyone</span></span><br><span class=\"line\"><span class=\"comment\"># This workflow is triggered on pushes to the repository.</span></span><br><span class=\"line\"><span class=\"attr\">on:</span> <span class=\"string\">[push]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\"><span class=\"attr\">  build:</span></span><br><span class=\"line\">    <span class=\"comment\"># Job name is Greeting</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">Greeting</span></span><br><span class=\"line\">    <span class=\"comment\"># This job runs on Linux</span></span><br><span class=\"line\"><span class=\"attr\">    runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\"><span class=\"attr\">    steps:</span></span><br><span class=\"line\">      <span class=\"comment\"># This step uses GitHub's hello-world-javascript-action: https://github.com/actions/hello-world-javascript-action</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">Hello</span> <span class=\"string\">world</span></span><br><span class=\"line\"><span class=\"attr\">        uses:</span> <span class=\"string\">actions/hello-world-javascript-action@v1</span></span><br><span class=\"line\"><span class=\"attr\">        with:</span></span><br><span class=\"line\"><span class=\"attr\">          who-to-greet:</span> <span class=\"string\">'Mona the Octocat'</span></span><br><span class=\"line\"><span class=\"attr\">        id:</span> <span class=\"string\">hello</span></span><br><span class=\"line\">      <span class=\"comment\"># This step prints an output (time) from the previous step's action.</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">Echo</span> <span class=\"string\">the</span> <span class=\"string\">greeting's</span> <span class=\"string\">time</span></span><br><span class=\"line\"><span class=\"attr\">        run:</span> <span class=\"string\">echo</span> <span class=\"string\">'The time was $<span class=\"template-variable\">&#123;&#123; steps.hello.outputs.time &#125;&#125;</span>.'</span></span><br></pre></td></tr></table></div></figure>\n<h2 id=\"triggering-a-workflow-with-events\"><a class=\"markdownIt-Anchor\" href=\"cicd#triggering-a-workflow-with-events\"></a> Triggering a workflow with events<a href=\"cicd#triggering-a-workflow-with-events\"></a></h2>\n<p>You can configure a workflow to start once:</p>\n<ul>\n<li>An event on GitHub occurs, such as when someone pushes a commit to a repository or when an issue or pull request is created.</li>\n<li>A scheduled event begins.</li>\n<li>An external event occurs.</li>\n</ul>\n<h2 id=\"getting-started-with-a-workflow\"><a class=\"markdownIt-Anchor\" href=\"cicd#getting-started-with-a-workflow\"></a> Getting started with a workflow<a href=\"cicd#getting-started-with-a-workflow\"></a></h2>\n<p>To help you get started, this guide shows you some basic examples. For the full GitHub Actions documentation on workflows, see “<a href=\"https://help.github.com/articles/configuring-workflows\" target=\"_blank\" rel=\"noopener\">Configuring workflows</a>.”</p>\n<p><img src=\"/cicd/image-20200301143401814.png\" alt=\"image-20200301143401814\" class=\"article-img\"></p>\n<h3 id=\"customizing-when-workflow-runs-are-triggered\"><a class=\"markdownIt-Anchor\" href=\"cicd#customizing-when-workflow-runs-are-triggered\"></a> Customizing when workflow runs are triggered<a href=\"cicd#customizing-when-workflow-runs-are-triggered\"></a></h3>\n<ul>\n<li>\n<p>Set your workflow to run on push events to the <code>master</code> and <code>release/*</code> branches</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on:</span><br><span class=\"line\">  push:</span><br><span class=\"line\">    branches:</span><br><span class=\"line\">    - master</span><br><span class=\"line\">    - release/*</span><br></pre></td></tr></table></div></figure>\n</li>\n<li>\n<p>Set your workflow to run on <code>pull_request</code> events that target the <code>master</code> branch</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on:</span><br><span class=\"line\">  pull_request:</span><br><span class=\"line\">    branches:</span><br><span class=\"line\">    - master</span><br></pre></td></tr></table></div></figure>\n</li>\n<li>\n<p>Set your workflow to run every day of the week from Monday to Friday at 2:00 UTC</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on:</span><br><span class=\"line\">  schedule:</span><br><span class=\"line\">  - cron: &quot;0 2 * * 1-5&quot;</span><br></pre></td></tr></table></div></figure>\n</li>\n</ul>\n<p>For more information, see “<a href=\"https://help.github.com/articles/events-that-trigger-workflows\" target=\"_blank\" rel=\"noopener\">Events that trigger workflows</a>.”</p>\n<h3 id=\"running-your-jobs-on-different-operating-systems\"><a class=\"markdownIt-Anchor\" href=\"cicd#running-your-jobs-on-different-operating-systems\"></a> Running your jobs on different operating systems<a href=\"cicd#running-your-jobs-on-different-operating-systems\"></a></h3>\n<p>GitHub Actions provides hosted runners for Linux, Windows, and macOS.</p>\n<p>To set the operating system for your job, specify the operating system using <code>runs-on</code>:</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jobs:</span><br><span class=\"line\">  my_job:</span><br><span class=\"line\">    name: deploy to staging</span><br><span class=\"line\">    runs-on: ubuntu-18.04</span><br></pre></td></tr></table></div></figure>\n<p>The available virtual machine types are:</p>\n<ul>\n<li><code>ubuntu-latest</code>, <code>ubuntu-18.04</code>, or <code>ubuntu-16.04</code></li>\n<li><code>windows-latest</code>, <code>windows-2019</code>, or <code>windows-2016</code></li>\n<li><code>macOS-latest</code> or <code>macOS-10.14</code></li>\n</ul>\n<p>For more information, see “<a href=\"https://help.github.com/articles/virtual-environments-for-github-actions\" target=\"_blank\" rel=\"noopener\">Virtual environments for GitHub Actions</a>.”</p>\n<h3 id=\"using-an-action\"><a class=\"markdownIt-Anchor\" href=\"cicd#using-an-action\"></a> Using an action<a href=\"cicd#using-an-action\"></a></h3>\n<p>Actions are reusable units of code that can be built and distributed by anyone on GitHub. You can find a variety of actions in <a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">GitHub Marketplace</a>, and also in the official <a href=\"https://github.com/actions/\" target=\"_blank\" rel=\"noopener\">Actions repository</a>.</p>\n<p>To use an action, you must specify the repository that contains the action. We also recommend that you specify a Git tag to ensure you are using a released version of the action.</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- name: Setup Node</span><br><span class=\"line\">  uses: actions/setup-node@v1</span><br><span class=\"line\">  with:</span><br><span class=\"line\">    node-version: &apos;10.x&apos;</span><br></pre></td></tr></table></div></figure>\n<p>For more information, see “<a href=\"https://help.github.com/articles/workflow-syntax-for-github-actions#jobsjob_idstepsuses\" target=\"_blank\" rel=\"noopener\">Workflow syntax for GitHub Actions</a>.”</p>\n<h3 id=\"running-a-command\"><a class=\"markdownIt-Anchor\" href=\"cicd#running-a-command\"></a> Running a command<a href=\"cicd#running-a-command\"></a></h3>\n<p>You can run commands on the job’s virtual machine.</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- name: Install Dependencies</span><br><span class=\"line\">  run: npm install</span><br></pre></td></tr></table></div></figure>\n<p>For more information, see “<a href=\"https://help.github.com/articles/workflow-syntax-for-github-actions#jobsjob_idstepsrun\" target=\"_blank\" rel=\"noopener\">Workflow syntax for GitHub Actions</a>.”</p>\n<h3 id=\"running-a-job-across-a-matrix-of-operating-systems-and-runtime-versions\"><a class=\"markdownIt-Anchor\" href=\"cicd#running-a-job-across-a-matrix-of-operating-systems-and-runtime-versions\"></a> Running a job across a matrix of operating systems and runtime versions<a href=\"cicd#running-a-job-across-a-matrix-of-operating-systems-and-runtime-versions\"></a></h3>\n<p>You can automatically run a job across a set of different values, such as different versions of code libraries or operating systems.</p>\n<p>For example, this job uses a matrix strategy to run across 3 versions of Node and 3 operating systems:</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jobs:</span><br><span class=\"line\">  test:</span><br><span class=\"line\">    name: Test on node $&#123;&#123; matrix.node_version &#125;&#125; and $&#123;&#123; matrix.os &#125;&#125;</span><br><span class=\"line\">    runs-on: $&#123;&#123; matrix.os &#125;&#125;</span><br><span class=\"line\">    strategy:</span><br><span class=\"line\">      matrix:</span><br><span class=\"line\">        node_version: [&apos;8&apos;, &apos;10&apos;, &apos;12&apos;]</span><br><span class=\"line\">        os: [ubuntu-latest, windows-latest, macOS-latest]</span><br><span class=\"line\"></span><br><span class=\"line\">    steps:</span><br><span class=\"line\">    - uses: actions/checkout@v1</span><br><span class=\"line\">    - name: Use Node.js $&#123;&#123; matrix.node_version &#125;&#125;</span><br><span class=\"line\">      uses: actions/setup-node@v1</span><br><span class=\"line\">      with:</span><br><span class=\"line\">        node-version: $&#123;&#123; matrix.node_version &#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    - name: npm install, build and test</span><br><span class=\"line\">      run: |</span><br><span class=\"line\">        npm install</span><br><span class=\"line\">        npm run build --if-present</span><br><span class=\"line\">        npm test</span><br></pre></td></tr></table></div></figure>\n<p>For more information, see “<a href=\"https://help.github.com/articles/workflow-syntax-for-github-actions#jobsjob_idstrategy\" target=\"_blank\" rel=\"noopener\">Workflow syntax for GitHub Actions</a>.”</p>\n<h3 id=\"running-steps-or-jobs-conditionally\"><a class=\"markdownIt-Anchor\" href=\"cicd#running-steps-or-jobs-conditionally\"></a> Running steps or jobs conditionally<a href=\"cicd#running-steps-or-jobs-conditionally\"></a></h3>\n<p>GitHub Actions supports conditions on steps and jobs using data present in your workflow context.</p>\n<p>For example, to run a step only as part of a push and not in a pull_request, you can specify a condition in the <code>if:</code> property based on the event name:</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">steps:</span><br><span class=\"line\">- run: npm publish</span><br><span class=\"line\">  if: github.event == &apos;push&apos;</span><br></pre></td></tr></table></div></figure>\n<h1 id=\"reference\"><a class=\"markdownIt-Anchor\" href=\"cicd#reference\"></a> Reference<a href=\"cicd#reference\"></a></h1>\n<ul>\n<li><a href=\"https://help.github.com/en/actions/\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/actions/</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/34291715\" target=\"_blank\" rel=\"noopener\">https://zhuanlan.zhihu.com/p/34291715</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/91371659\" target=\"_blank\" rel=\"noopener\">https://zhuanlan.zhihu.com/p/91371659</a></li>\n</ul>\n<blockquote>\n<p>非商业用途，不当引用导致利益纠纷与本人无关</p>\n</blockquote>\n","prev":{"title":"传感器导论","link":"Review/SensorTechnology"},"next":{"title":"低成本个人NAS搭建解决方案（带内网穿透）","link":"Others/privateNas"},"plink":"ilucia.github.io/cicd/","toc":[{"title":"<a class=\"markdownIt-Anchor\"></a> 关于DevOps和CICD","id":"关于devops和cicd","index":"1","children":[{"title":"<a class=\"markdownIt-Anchor\"></a> 一些前置名词介绍","id":"一些前置名词介绍","index":"1.1"}]},{"title":"<a class=\"markdownIt-Anchor\"></a> 为什么需要DevOps?","id":"为什么需要devops","index":"2"},{"title":"<a class=\"markdownIt-Anchor\"></a> CICD实践：以GitHub action平台为例","id":"cicd实践以github-action平台为例","index":"3","children":[{"title":"<a class=\"markdownIt-Anchor\"></a> UI","id":"ui","index":"3.1"},{"title":"<a class=\"markdownIt-Anchor\"></a> Creating a workflow file","id":"creating-a-workflow-file","index":"3.2"},{"title":"<a class=\"markdownIt-Anchor\"></a> Sample","id":"sample","index":"3.3"},{"title":"<a class=\"markdownIt-Anchor\"></a> Triggering a workflow with events","id":"triggering-a-workflow-with-events","index":"3.4"},{"title":"<a class=\"markdownIt-Anchor\"></a> Getting started with a workflow","id":"getting-started-with-a-workflow","index":"3.5","children":[{"title":"<a class=\"markdownIt-Anchor\"></a> Customizing when workflow runs are triggered","id":"customizing-when-workflow-runs-are-triggered","index":"3.5.1"},{"title":"<a class=\"markdownIt-Anchor\"></a> Running your jobs on different operating systems","id":"running-your-jobs-on-different-operating-systems","index":"3.5.2"},{"title":"<a class=\"markdownIt-Anchor\"></a> Using an action","id":"using-an-action","index":"3.5.3"},{"title":"<a class=\"markdownIt-Anchor\"></a> Running a command","id":"running-a-command","index":"3.5.4"},{"title":"<a class=\"markdownIt-Anchor\"></a> Running a job across a matrix of operating systems and runtime versions","id":"running-a-job-across-a-matrix-of-operating-systems-and-runtime-versions","index":"3.5.5"},{"title":"<a class=\"markdownIt-Anchor\"></a> Running steps or jobs conditionally","id":"running-steps-or-jobs-conditionally","index":"3.5.6"}]}]},{"title":"<a class=\"markdownIt-Anchor\"></a> Reference","id":"reference","index":"4"}],"copyright":{"author":"Ilucia Niu","license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\">知识共享署名 4.0 国际许可协议</a>","published":"2020年3月1日","updated":"2022年4月27日"}}